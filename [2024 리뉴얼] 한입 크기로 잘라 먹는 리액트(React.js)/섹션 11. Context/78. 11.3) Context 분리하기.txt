78. 11.3) Context ë¶„ë¦¬í•˜ê¸°

. ìµœì í™”ê°€ í’€ë¦¬ëŠ” ë¬¸ì œê°€ í™•ì¸ë˜ì—ˆìŒ!
. ì™œ ë¬¸ì œê°€ ë°œìƒí–ˆì„ê¹Œ?
Propsê°€ ë³€ê²½ë˜ë©´ ë¦¬ë Œë”ë§ì´ ëœë‹¤.

. ì–´ë–»ê²Œ í•´ê²°í•˜ë‚˜ìš”?!

					TodoContext
TodoStateContext						TodoDispatchContext
ë³€ê²½ë  ìˆ˜ ìˆëŠ” ê°’
	todos

App.jsx ìˆ˜ì •
List.jsx ìˆ˜ì •
TodoItem.jsx ìˆ˜ì •
Editor.jsx ìˆ˜ì •

useMemoë¥¼ ì‚¬ìš©í•œ ì´ìœ  
---

App.jsx

import './App.css'
import { useState, useRef, useReducer, useCallback, createContext, useMemo } from 'react'
import Header from './components/Header'
import Editor from './components/Editor'
import List from './components/List'

const mockData = [
  {
    id : 0,
    isDone : false,
    content : "React ê³µë¶€í•˜ê¸°",
    date : new Date().getTime(),
  },
  {
    id : 1,
    isDone : false,
    content : "ì˜í™” ê°ìƒí•˜ê¸°",
    date : new Date().getTime(),
  },
  {
    id : 2,
    isDone : false,
    content : "ë³¼ë§",
    date : new Date().getTime(),
  },
];

function reducer(state, action) {
  switch(action.type) {
    case 'CREATE' : return [action.data, ...state]
    case 'UPDATE' : return state.map((item) => item.id === action.targetId? {...item, isDone: !item.isDone} : item);
    case 'DELETE' : return state.filter((item)=>item.id !== action.targetId)
    default : return state;
  }
}

// Context ê°ì²´ëŠ” ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì— ì„ ì–¸ í•œë‹¤! ì™œëƒí•˜ë©´ ë‚´ë¶€ì— ì„ ì–¸í•˜ë©´ App.jsê°€ ë¦¬ë Œë”ë§ ë ë•Œë§ˆë‹¤ ë‹¤ì‹œ ìƒì„±ë  í•„ìš”ëŠ” ì—†ìœ¼ë‹ˆ!
// export const TodoContext = createContext();

// ìµœì í™”ê°€ í’€ë¦¬ëŠ” í˜„ìƒì´ ì¡´ì¬í•˜ì—¬ì„œ ì•„ë˜ ì½”ë“œë¡œ ìˆ˜ì •!
export const TodoStateContext = createContext();
export const TodoDispatchContext = createContext();

function App() {
  
  const [todos, dispatch] = useReducer(reducer, mockData);
  const idRef = useRef(3);

  // ì•„ì´í…œ ì¶”ê°€ (useCallback ì´ìš©)
  const onCreate = useCallback((content) =>{
    dispatch({
      type : "CREATE",
      data : {
        id : idRef.current++,
        isDone : false,
        content : content,
        date : new Date().getTime(),
      },
    });
  }, []);

  // ì•„ì´í…œ ìˆ˜ì • (useCallback ì´ìš©)
  const onUpdate = useCallback((targetId) => {
    dispatch({
      type: "UPDATE",
      targetId: targetId,
    });
  }, [])


  // ì•„ì´í…œ ì‚­ì œ (useCallback ì´ìš©)
  const onDelete = useCallback((targetId) => {
    dispatch({
      type : "DELETE",
      targetId : targetId,
    });
  }, []);

  // onCrea, upDate, Delete í•¨ìˆ˜ë¥¼ ë¬¶ì–´ì£¼ëŠ” ê°œì²´ë¥¼ ë‹¤ì‹œëŠ” ìƒì„±í•˜ì§€ ì•Šë„ë¡ ë§Œë“¤ì–´ ì£¼ê¸° ìœ„í•´
  const memoizedDispatch = useMemo(()=> {
    return { onCreate, onUpdate, onDelete };
  }, []);

  return (
   <div className="App">
      {/* <Exam /> */}
      <Header />
      {/* <TodoContext.Provider value={{todos, onCreate, onUpdate, onDelete,}}> */}
      <TodoStateContext.Provider value = {todos} >
        <TodoDispatchContext.Provider value = {memoizedDispatch}>
          <Editor />
          <List />
        </TodoDispatchContext.Provider>
      </TodoStateContext.Provider>
        {/* </TodoContext.Provider> */}
    </div>
  )
}

export default App;

---
List.jsx

import "./List.css"
import TodoItem from "./TodoItem";
import { useState, useMemo, useContext } from "react";
import { TodoStateContext } from "../App";

const List = (  ) => {
    const todos = useContext(TodoStateContext);

    const [search, setSearch] = useState("");

    const onChangeSearch = (e) => {
        setSearch(e.target.value);
    };

    const getFilteredDate = () => {
        if(search === "") {
            return todos;
        }
        return todos.filter((todo) =>
            todo.content.toLowerCase().includes(search.toLocaleLowerCase())   // includes ì¸ìˆ˜ë¡œ ì „ë‹¬í•œ ê°’ì´ todo.contentì— ë³´ê´€ ë˜ì–´ìˆëŠ”ì§€ í™•ì¸ì„ í•˜ë©°, ìˆì„ê²½ìš° true, ì—†ì„ê²½ìš° falseë¥¼ ë°˜í™˜í•œë‹¤.
        );
    };

    const filteredTodos = getFilteredDate();

    const {totalCount, doneCount, notDonecount} =
     useMemo(() => {
        console.log("getAnalyzedData í˜¸ì¶œ!");

        const totalCount = todos.length;
        const doneCount = todos.filter(
            (todo)=>todo.isDone
        ).length;
        const notDonecount = totalCount - doneCount;

        return {
            totalCount,
            doneCount,
            notDonecount,
        }
    }, [todos])
    // ì˜ì¡´ì„± ë°°ì—´ : deps

    // const {totalCount, doneCount, notDonecount} = getAnalyzedData()

    return (
        <div className="List">
            <h4>Todo List ğŸ‘Œ</h4>
            <div>
                total: {totalCount}
            </div>
            <div>
                done: {doneCount}
            </div>
            <div>
                notDone: {notDonecount}
            </div>
            <input
                value = {search}
                onChange = {onChangeSearch}
                placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
            />
            <div className="todos_wrapper">
                {filteredTodos.map((todo)=>{
                    return (
                        <TodoItem
                            key = {todo.id}
                            {...todo}
                        />
                    );
                })}
            </div>
        </div>
    );
};

export default List;

---
TodoItem.jsx

import "./TodoItem.css";
import { memo, useContext } from 'react';
import { TodoDispatchContext } from "../App";

const TodoItem = ({
    id,
    isDone,
    content,
    date,
}) => {

    const {onUpdate, onDelete} = useContext(TodoDispatchContext);

    const onChangeCheckbox = () => {
        onUpdate(id);
    };

    const onClickDeleteButton = () => {
        onDelete(id);
    };

    return (
        <div className="TodoItem">
            <input
                // inputìš”ì†Œì´ê¸°ì— onChangeë¡œ ì„ ì–¸ì„ í•˜ì˜€ìŒ.
                onChange={onChangeCheckbox}
                readOnly
                checked={isDone}
                type="checkbox" />
            <div className="content">{content}</div>
            <div className="date">
                {new Date(date).toLocaleDateString()}
            </div>
            <button onClick={onClickDeleteButton}>ì‚­ì œ</button>
        </div>
    );
};

export default TodoItem;

// ê³ ì°¨ ì»´í¬ë„ŒíŠ¸ (HOC)
// export default memo(TodoItem, (prevProps, nextProps)=>{
//     // ë°˜í™˜ê°’ì— ë”°ë¼, Propsê°€ ë°”ë€Œì—ˆëŠ”ì§€ ì•ˆë°”ë€Œì—ˆëŠ”ì§€ íŒë‹¨
//     // True -> Props ë°”ë€Œì§€ ì•ŠìŒ -> ë¦¬ë Œë”ë§ X
//     // False -> Props ë°”ë€œ -> ë¦¬ë Œë”ë§ O

//     if(prevProps.id !== nextProps.id) return false;
//     if(prevProps.isDone !== nextProps.isDone) return false;
//     if(prevProps.content !== nextProps.content) return false;
//     if(prevProps.date !== nextProps.date) return false;

//     return true;
// });

---
Editor.jsx

import { useState, useRef, useContext } from "react";
import "./Editor.css";
// import { TodoContext } from "../App";
import { TodoDispatchContext } from "../App";

const Editor = () => {
    const { onCreate } = useContext(TodoDispatchContext);

    const [content, setContent] = useState("");
    const contentRef = useRef();

    const onChangeContent = (e) => {
        setContent(e.target.value);
    };

    // Enterí‚¤ë¥¼ ì…ë ¥ í•˜ì˜€ì„ ê²½ìš°, onSubmit í•¨ìˆ˜ ì‹¤í–‰!
    const onKeydown = (e) => {
        if(e.keyCode === 13){
            onSubmit();
        }
    };

    const onSubmit = () => {
        // ì…ë ¥í¼ì´ ê³µë€ì¸ ê²½ìš° í¬ì»¤ì‹±ê³¼ ì…ë ¥ì´ ë˜ì§€ ì•Šë„ë¡ í•˜ëŠ”ê¸°ëŠ¥ ì¶”ê°€!
        if (content === "") {
            contentRef.current.focus();
            return;
        }
        onCreate(content);
        setContent(""); // ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€ í›„, ì…ë ¥í¼ ì´ˆê¸°í™”!
    };
    return (
        <div className="Editor">
            <input value={content}
            ref ={contentRef}
            onKeyDown={onKeydown}
            onChange={onChangeContent}
            placeholder="ìƒˆë¡œìš´ Todo..."/>
            <button onClick={onSubmit}>ì¶”ê°€</button>
        </div>
    );
};

export default Editor;